---
import { Astro } from 'astro';
const homeUrl = '/';
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Sign in â€¢ PlanIt</title>
    <!-- Netlify Identity Widget -->
    <script defer src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  </head>
  <body style="font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 2rem;">
    <h1>Sign in</h1>
    <p>The sign-in dialog should open automatically. If not, <a href="#" id="open">open it</a>.</p>

    <script is:inline>
      // Wait for the widget to be ready
      document.addEventListener('DOMContentLoaded', () => {
        // Open the login panel immediately
        if (window.netlifyIdentity) {
          netlifyIdentity.on('init', () => netlifyIdentity.open('login'));
          netlifyIdentity.on('login', () => {
            // After successful login, go home
            window.location.assign("{{homeUrl}}".replace('{{homeUrl}}', '{{homeUrl}}'));
          });
          netlifyIdentity.on('error', (e) => console.error('Identity error:', e));
          netlifyIdentity.init();
        }

        document.getElementById('open')?.addEventListener('click', (e) => {
          e.preventDefault();
          window.netlifyIdentity?.open('login');
        });
      });
    </script>
  </body>
</html>
